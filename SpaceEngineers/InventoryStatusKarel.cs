using Sandbox.Game.EntityComponents;
using Sandbox.ModAPI.Ingame;
using Sandbox.ModAPI.Interfaces;
using SpaceEngineers.Game.ModAPI.Ingame;
using System;
using System.Collections;
using System.Collections.Generic;
using System.Collections.Immutable;
using System.Linq;
using System.Text;
using VRage;
using VRage.Collections;
using VRage.Game;
using VRage.Game.Components;
using VRage.Game.GUI.TextPanel;
using VRage.Game.ModAPI.Ingame;
using VRage.Game.ModAPI.Ingame.Utilities;
using VRage.Game.ObjectBuilders.Definitions;
using VRageMath;

namespace IngameScript
{
    partial class Program : MyGridProgram
    {
        int cockpitIndex = 1;
        public Program()
        {
            Runtime.UpdateFrequency = UpdateFrequency.Update10;
        }

        public void Main(string argument, UpdateType updateSource)
        {
            IMyCockpit cockpit = GridTerminalSystem.GetBlockWithName("Industrial Cockpit") as IMyCockpit;

            double dTotalVolume = 0;
            double dTotalMaxVolume = 0;

            var aCargoList = new List<IMyTerminalBlock>();
            GridTerminalSystem.GetBlocksOfType<IMyTerminalBlock>(aCargoList);

            foreach (IMyTerminalBlock oCargoContainer in aCargoList)
            {
                IMyEntity oCargoContainerEntity = oCargoContainer as IMyEntity;

                if (!oCargoContainerEntity.HasInventory)
                    continue;

                if (Me.CubeGrid != oCargoContainer.CubeGrid)
                    continue;

                try
                {
                    string park = oCargoContainer.GetActionWithName("Park").ToString();
                    continue;
                }
                catch
                {

                }

                IMyInventory oCurrentInventory = oCargoContainerEntity.GetInventory();
                dTotalVolume += (double)oCurrentInventory.CurrentVolume.RawValue;
                dTotalMaxVolume += (double)oCurrentInventory.MaxVolume.RawValue;
            }

            double dVolumePercentage = dTotalVolume / dTotalMaxVolume * 100.0;

            IMyTextSurface givenScreen = PreparePanel(cockpit);
            givenScreen.WriteText(Math.Round(dVolumePercentage, 1).ToString());
            cockpit.GetSurface(cockpitIndex).WriteText(Math.Round(dVolumePercentage, 1).ToString());

            if (dVolumePercentage > (double)95) //if full
            {
                givenScreen.FontColor = new Color(255, 0, 0);
                cockpit.GetSurface(cockpitIndex).FontColor = new Color(255, 0, 0);
            }
            else if (dVolumePercentage > (double)75)
            {
                cockpit.GetSurface(cockpitIndex).FontColor = new Color(200, 150, 0);
                givenScreen.FontColor = new Color(200, 150, 0);
            }
            else if (dVolumePercentage > (double)50)
            {
                cockpit.GetSurface(cockpitIndex).FontColor = new Color(232, 179, 35);
                givenScreen.FontColor = new Color(232, 179, 35);
            }
            else if (dVolumePercentage > (double)0)
            {
                cockpit.GetSurface(cockpitIndex).FontColor = new Color(0, 200, 0);
                givenScreen.FontColor = new Color(0, 200, 0);
            }

            else // if empty
            {
                givenScreen = PrepareLogo(cockpit);
                cockpit.GetSurface(cockpitIndex).WriteText(getCatLogo());
                givenScreen.WriteText(getCatLogo());
            }
        }

        IMyTextSurface PreparePanel(IMyCockpit cockpit = null)
        {
            IMyTextSurface terminalScreen = (GridTerminalSystem.GetBlockWithName("Inventory Status Logic") as IMyTextSurfaceProvider).GetSurface(0);
            IMyTextSurface cockpitScreen = cockpit.GetSurface(cockpitIndex);



            if (terminalScreen != null)
            {
                //terminalScreen.SetValue<Int64>("Content", 1);
                terminalScreen.ContentType = ContentType.TEXT_AND_IMAGE;
                // Blue bg color = 0, 136, 190
                terminalScreen.FontColor = new Color(232, 179, 35);
                terminalScreen.Font = "Monospace";
                terminalScreen.FontSize = (float)6;
                terminalScreen.Alignment = TextAlignment.CENTER;
                terminalScreen.TextPadding = 26;
            }
            if (cockpit != null)
            {
                cockpitScreen.ContentType = ContentType.TEXT_AND_IMAGE;
                // Blue bg color = 0, 136, 190
                cockpitScreen.FontColor = new Color(255, 255, 255);
                cockpitScreen.Font = "Monospace";
                cockpitScreen.FontSize = (float)6;
                cockpitScreen.Alignment = TextAlignment.LEFT;
                cockpitScreen.TextPadding = 0;
            }

            return terminalScreen;
        }

        IMyTextSurface PrepareLogo(IMyCockpit cockpit)
        {
            IMyTextSurface terminalScreen = (GridTerminalSystem.GetBlockWithName("Inventory Status Logic") as IMyTextSurfaceProvider).GetSurface(0);
            IMyTextSurface cockpitScreen = cockpit.GetSurface(cockpitIndex);

            if (terminalScreen != null)
            {
                terminalScreen.ContentType = ContentType.TEXT_AND_IMAGE;
                // Blue bg color = 0, 136, 190
                terminalScreen.FontColor = new Color(255, 255, 255);
                terminalScreen.Font = "Monospace";
                terminalScreen.FontSize = (float)0.1;
                terminalScreen.Alignment = TextAlignment.LEFT;
                terminalScreen.TextPadding = 0;
            }
            if (cockpit != null)
            {
                cockpitScreen.ContentType = ContentType.TEXT_AND_IMAGE;
                // Blue bg color = 0, 136, 190
                cockpitScreen.FontColor = new Color(255, 255, 255);
                cockpitScreen.Font = "Monospace";
                cockpitScreen.FontSize = (float)0.1;
                cockpitScreen.Alignment = TextAlignment.LEFT;
                cockpitScreen.TextPadding = 0;
            }
            return terminalScreen;
        }

        public string getCatLogo()
        {
            string sCatLogo = "";
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            sCatLogo += "" + Environment.NewLine;
            return sCatLogo;
        }
    }
}